<!DOCTYPE html>
<html>
<head>
  <!-- Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script> 
  <script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.min.js"></script>
</head>

<body>
  
  <div  ng-app = "" >
  <div id="myDiv"  ng-controller = "promotion">
  <div id="myDiv1"  ng-controller = "departmentTrends">
  </div>
  </div>
  
  <script>
	function promotion($scope,$http) {
	var output;
    $http({
		url:"http://localhost:80/getPromotionStats",
		dataType: "json",
		data: '',
		method: "GET",
		headers: {
			"Content-Type": "application/json"
		}}).then( function(response) 
		{
               $scope.promotionStats = response.data;
			   console.log($scope.promotionStats)
			   var xData = []
			   var yData = []
			   for( var i in $scope.promotionStats){
					xData.push(i)
					yData.push($scope.promotionStats[i])
				}
				console.log(yData)
				console.log(xData)
				var data = [{
					values: yData,
					labels: xData,
					type: 'pie'
				}];

				var layout = {
					title: 'Promotions per Department',
					height: 450,
					width: 550
				};

				Plotly.newPlot('myDiv', data, layout);
         });
	}
	function departmentTrends($scope,$http) {
	var output;
    $http({
		url:"http://localhost:80/getDeptTrends",
		dataType: "json",
		data: '',
		method: "GET",
		headers: {
			"Content-Type": "application/json"
		}}).then( function(response) 
		{
               $scope.departmentData = response.data;
			   console.log($scope.departmentData)
			   var xData = []
			   var y1Data = []
			   var y2Data = []
			   for( var i in $scope.departmentData){
					xData.push(i)
					y2Data.push($scope.departmentData[i][0])
					y1Data.push($scope.departmentData[i][1]-$scope.departmentData[i][0])
				}
				var trace1 = {
				x: xData,
				y: y1Data,
				name: 'Current Employees',
				type: 'bar'
				};

				var trace2 = {
				x: xData,
				y: y2Data,
				name: 'Left Employees',
				type: 'bar'
				};

				var data = [trace1, trace2];

				var layout = {
				title: 'Employees Count Statistics per Department',
				height: 450,
				width:  600,
				barmode: 'stack'
				};

				Plotly.newPlot('myDiv1', data, layout);

         });
	}

  </script>
</body>
</html>